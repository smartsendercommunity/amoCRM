# amoCRM
Интеграция с amoCRM.

Доступные на данный момент функции:

Прямые запросы на API amoCRM (для тех, кто любит все контролировать самостоятельно)
Создание/обновление контактов в amoCRM
Чтение созданных контактов в amoCRM
Создание/обновление сделок в amoCRM
Чтение сделок amoCRM
Добавления текстового примечания к контакту/сделке
Создание задач (независимые или прикрепленные к контакту/сделке)
Укорачивание ссылок с отслеживанием перехода в интерфейсе amoCRM
Обратная интеграция (добавление/удаление тегов, подписка/отписка от воронки, запуск триггеров, обновление переменных) по событиям в воронках сделок amoCRM
Передача сообщений от пользователей в amoCRM и возможность отвечать пользователям (а также отправлять им фото, документы, файлы) из интерфейса amoCRM (!!! требуется заявка на доступ к чатам amoCRM (amojo) через поддержку !!! Все данные для заявки предоставляются файлом connect.php автоматически)


Шаблон с примерами "Внешних запросов"
https://messenger.smartsender.com/t/lDJQ1df9Y2YBSpYJ5WWleoa7FHBb2mbYKMZ0SmCn


Инструкция:

Скачать архив и загрузить на хостинг (файл .htaccess загрузить в корень домена)
В настройках amoCRM создать новую "Внешнюю" интеграцию
"https://exemple.com" - любая ссылка переадресации (необходимо будет указать в настройках п.3), используется для получения/обновления токенов доступа
Все остальные данные на Ваше усмотрение (не забудьте установить галочку "Предоставить доступ")
На хостинге открыть файл "config.php" и указать там следующие данные (внутри кавычек) используя данные в amoCRM (скрин http://prntscr.com/20mz1vq )
$amo_key - строка 4 на скриншоте;
$amo_id - строка 5 на скриншоте;
$amo_code - строка 6 на скриншоте (действителен 20 мин. Если не успеете авторизовать скрипт, скопируйте новый код авторизации);
$amo_url - строка 7 на скриншоте;
$amo_uri - ссылка переадресации, указанная при создании интеграции в первом поле;
$ss_token - токен проекта на Smart Sender (для обратной интеграции);
Сохранить файл.
Открыть браузером (как обычную страницу) файл "connect.php". Должно отобразится сообщение об успешной авторизации
Импортировать шаблон
Использовать примеры из шаблона в Ваших воронках
При необходимости настроить правила для обратной интеграции:
Зайти в настройки воронок сделок
В нужном статусе Вашей воронки добавить триггер "Отправить webhook"
Настроить все необходимые параметры (1. Фильтр; 2. Параметры запуска; 3. Урл вебхука на файл .../webhooks.php )
Добавить к ссылке необходимые параметры. (Доступно: ?addTags[]=название_Тега&delTags[]=названиеТега&addFunnel[]=название_Воронки&delFunnel[]=названиеВоронки&triggers[]=название_Триггера&variables[переменная_SS]=[поле_amo] Можно использовать любое количество любых параметров. Ненужные удалить, нужные скопировать.)
Сохранить изменения
В процессе работы интеграцией будут дополнительно созданы файлы "access.json" и "users.json". Не удаляйте эти файлы без уважительных на то причин.

Файл "access.json" содержит токены доступа к Вашему amoCRM. Никому не передавайте этот файл.

Файл "users.json" содержит информацию о созданных в amoCRM контактах из Smart Sender. Благодаря этому файлу контакты обновляются, а не создаются дублирующие. Также этот файл используется для прикрепления сделки к контакту и для привязки укороченной ссылки.
