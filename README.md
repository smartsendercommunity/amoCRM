# amoCRM
Интеграция с amoCRM.

Доступные на данный момент функции:

1.	Прямые запросы на API amoCRM (для тех, кто любит все контролировать самостоятельно)
2.	Создание/обновление контактов в amoCRM
3.	Чтение созданных контактов в amoCRM
4.	Создание/обновление сделок в amoCRM
5.	Чтение сделок amoCRM
6.	Добавления текстового примечания к контакту/сделке
7.	Создание задач (независимые или прикрепленные к контакту/сделке)
8.	Укорачивание ссылок с отслеживанием перехода в интерфейсе amoCRM
9.	Обратная интеграция (добавление/удаление тегов, подписка/отписка от воронки, запуск триггеров, обновление переменных) по событиям в воронках сделок amoCRM
10.	Передача сообщений от пользователей в amoCRM и возможность отвечать пользователям (а также отправлять им фото, документы, файлы) из интерфейса amoCRM (!!! требуется заявка на доступ к чатам amoCRM (amojo) через поддержку !!! Все данные для заявки предоставляются файлом connect.php автоматически)


Шаблон с примерами "Внешних запросов"
https://smartsender.com/experts/20/templates/95


Инструкция:

1.	Скачать архив и загрузить на хостинг (файл .htaccess загрузить в корень домена)
2.	В настройках amoCRM создать новую "Внешнюю" интеграцию
3.	"https://exemple.com" - любая ссылка переадресации (необходимо будет указать в настройках п.3), используется для получения/обновления токенов доступа
4.	Все остальные данные на Ваше усмотрение (не забудьте установить галочку "Предоставить доступ")
5.	На хостинге открыть файл "config.php" и указать там следующие данные (внутри кавычек) используя данные в amoCRM (скрин http://prntscr.com/20mz1vq )

•	$amo_key - строка 4 на скриншоте;

•	$amo_id - строка 5 на скриншоте;

•	$amo_code - строка 6 на скриншоте (действителен 20 мин. Если не успеете авторизовать скрипт, скопируйте новый код авторизации);

•	$amo_url - строка 7 на скриншоте;

•	$amo_uri - ссылка переадресации, указанная при создании интеграции в первом поле;

•	$ss_token - токен проекта на Smart Sender (для обратной интеграции);

6.	Сохранить файл.

7.	Открыть браузером (как обычную страницу) файл "connect.php". Должно отобразится сообщение об успешной авторизации

8.	Импортировать шаблон

9.	Использовать примеры из шаблона в Ваших воронках

10.	При необходимости настроить правила для обратной интеграции:

11.	Зайти в настройки воронок сделок

12.	В нужном статусе Вашей воронки добавить триггер "Отправить webhook"

13.	Настроить все необходимые параметры (1. Фильтр; 2. Параметры запуска; 3. Урл вебхука на файл .../webhooks.php )

14.	Добавить к ссылке необходимые параметры. (Доступно: ?addTags[]=название_Тега&delTags[]=названиеТега&addFunnel[]=название_Воронки&delFunnel[]=названиеВоронки&triggers[]=название_Триггера&variables[переменная_SS]=[поле_amo] Можно использовать любое количество любых параметров. Ненужные удалить, нужные скопировать.)

15.	Сохранить изменения


В процессе работы интеграцией будут дополнительно созданы файлы "access.json" и "users.json". Не удаляйте эти файлы без уважительных на то причин.


Файл "access.json" содержит токены доступа к Вашему amoCRM. Никому не передавайте этот файл.


Файл "users.json" содержит информацию о созданных в amoCRM контактах из Smart Sender. Благодаря этому файлу контакты обновляются, а не создаются дублирующие. Также этот файл используется для прикрепления сделки к контакту и для привязки укороченной ссылки.
